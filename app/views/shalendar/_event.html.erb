<% if user_signed_in? %>
	<div class="event shield
		<% if event.ends_at.present? %>
			<%= event.ends_at < Time.now ? 'over' : '' %>
		<% end %> 
		<%= current_user.in?(event) ? 'in' : 'invite' %>
		<%= event.has_future_instance? ? 'time' : 'idea' %>
		<%= event.one_time? ? 'one_time' : '' %>"
		data-event-id='<%= event.id %>'>
<% else %>
	<div class="event shield 
		<% if event.starts_at.present? %>
			<%= event.ends_at < Time.now ? 'over' : '' %>
		<% end %>
		">
<% end %>

		<div class="shield_top">
			<div class="rsvp_check">
				<%= render :partial => "shalendar/rsvp_check", :locals => { :event => event } %>
			</div>
			<%= render :partial => 'shared/guest_count', :locals => { :event => event } %>		
		</div>

		<div class="event_blerb">
			<div class="title"><%= event.title %></div>
		</div>

		<% if event.has_image? %>
			<div class="promo_img">
				<%= image_tag event.image(:medium) %>
			</div>
		<% end %>

	<% if event.one_time? && @currently_ideas 
		 	@relevant_instances = [event]
		 else 
			@relevant_instances = event.instances.reject { |e| e.over? } 
			if user_signed_in?
				@relevant_instances = @relevant_instances.reject { |e| current_user.out?(e) }
			end
		 end 
	%>

	<%= render partial: 'events/time', collection: @relevant_instances, as: :event %>
	
	<% if user_signed_in? %>
		<% if !event.one_time? && current_user.in?(event) %>
			<%= link_to event_new_time_path(event) do %>
				<div class="add_time fadeInOrange"><i class="icon-time"></i> add new time</div>
			<% end %>
		<% end %>
	<% end %>
</div>