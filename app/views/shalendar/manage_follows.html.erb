<% provide(:title, " | Manage Views") %>
<div class="dashboard">
<%= render 'layouts/logo_and_user' %>
<%= render 'search' %> 
<h3>New View Requests</h3>
<%= render 'view_requests' %>
</div>

    <!-- VIEWERS AND VIEWING TABLES -->
<div id="views_list" class="container">
  <ul>
    <li><a href="#following">Following (<%= @followed_user_relationships.count %>)</a></li>
    <li><a href="#followers">Followers (<%= @follower_relationships.count %>)</a></li>
  </ul>
  <div id="following">
    <h2>Following</h2>
    <div class="user_table">
        <% @followed_user_relationships.each do |fur| %>
        <table>       
          <tr>
            <td width="50px"><%= small_profile_picture(fur.followed) %></td>
            <td width="150px"><%= fur.followed.name %> </td>
            <td>
              <span id="follow_form" class="follow_btn">
                <% if current_user.request_following?(fur.followed) %>
                  Request Sent...
                <% else %>
                  <%= render :partial => 'events/unfollow', :locals => { :user => fur.followed } %>
                <% end %>
              </span>
            </td>
          </tr>
      </table>
      <% end %>
    </div>
  </div>

  <div id="followers">
    <h2>Followers</h2>
    <div class="user_table">
      <% @follower_relationships.each do |fr| %>
      <table>        
          <tr>
            <td width="50px"><%= small_profile_picture(fr.follower) %></td>
            <td width="150px"><%= fr.follower.name %></td>
            <td>
              <span>
                <% if current_user.following?(fr.follower) %>
                  <%# do nothing... already displaying viewing above %>
                <% elsif current_user.request_following?(fr.follower) %>
                  <%# do nothing... already are displaying request sent above %>
                <% else %>
                  <%= render :partial => 'events/follow', :locals => { :user => fr.follower } %>
                <% end %>
                <%= link_to "Remove Viewer", relationship_remove_path(fr), class: "btn_remove", method: :delete, confirm: "Are you sure #{fr.follower.name} should no longer be able to view your ideas?" %>
              </span>
            </td>
            <td>
          </tr>
        </table>
        <% end %>
    </div>
  </div>
</div>